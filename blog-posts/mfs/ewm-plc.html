<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="In-depth article about SAP EWM MFS communication to the PLC. Learn technical details about telegram creation, handshake, and function modules like /SCWM/MFS_SEND.">
    <meta name="keywords" content="SAP EWM, Warehouse Management, MFS, PLC, Telegram, /SCWM/MFS_SEND, TCP/IP, APC">
    <meta name="author" content="Hendrik">
    <link rel="icon" type="image/png" href="/assets/favicon/wmexperts%20favicon.png">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Discover SAP EWM MFS | WMexperts">
    <meta property="og:description" content="In-depth article about SAP EWM MFS communication to the PLC. Learn technical details about telegram creation, handshake, and function modules like /SCWM/MFS_SEND.">
    <meta property="article:published_time" content="2025-01-01">
    <meta property="article:modified_time" content="2025-01-01">

    <!-- Structured Data -->
    <script type="application/ld+json">
    [
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "Discover SAP EWM MFS - The communication from EWM to the PLC",
        "description": "In-depth article about SAP EWM MFS communication to the PLC. Learn technical details about telegram creation, handshake, and function modules like /SCWM/MFS_SEND.",
        "image": "https://wmexperts.online/assets/images/placeholder.png",
        "datePublished": "2025-01-01",
        "dateModified": "2025-01-01",
        "author": {
          "@type": "Person",
          "name": "Hendrik"
        },
        "publisher": {
          "@type": "Organization",
          "name": "WMexperts",
          "logo": {
            "@type": "ImageObject",
            "url": "https://wmexperts.online/assets/logo.png"
          }
        }
      },
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://wmexperts.online/"
        },{
          "@type": "ListItem",
          "position": 2,
          "name": "Blog",
          "item": "https://wmexperts.online/blog-posts/category/mfs-automation.html"
        }]
      }
    ]
    </script>

    <title>Discover SAP EWM MFS | WMexperts</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --sap-blue: #005597;
            --bg-light: #F9FAFB;
            --text-dark: #111827;
            --text-muted: #4B5563;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--text-muted);
            margin: 0;
            line-height: 1.8;
        }

        /* --- NAVIGATION --- */
        header {
            background: #fff;
            padding: 1rem 10%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { font-weight: 600; font-size: 1.4rem; color: var(--text-dark); text-decoration: none; }
        .logo span { color: var(--sap-blue); }
        nav a { text-decoration: none; color: var(--text-muted); font-size: 0.9rem; font-weight: 600; }

        /* --- ARTICLE STRUCTURE --- */
        article { max-width: 800px; margin: 4rem auto; padding: 0 20px; }

        .breadcrumb {
            font-size: 0.75rem;
            color: var(--sap-blue);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        h1 { font-size: 2.8rem; color: var(--text-dark); line-height: 1.2; margin-bottom: 1.5rem; letter-spacing: -1px; }

        /* --- RESPONSIVE VIDEO CONTAINER --- */
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            margin: 2.5rem 0;
            border-radius: 12px;
            background: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .content p { margin-bottom: 0.75rem; font-size: 1.1rem; }
        .content h2 { color: var(--text-dark); margin-top: 1.75rem; font-size: 1.8rem; border-bottom: 2px solid var(--bg-light); padding-bottom: 0.5rem; }
        .content ul { padding-left: 1.5rem; margin-bottom: 2rem; }
        .content li { margin-bottom: 0.75rem; font-size: 1.05rem; }

        /* --- TECHNICAL & IMAGE BLOCKS --- */
        .screenshot-container { margin: 1.75rem 0; text-align: center; }
        
        .screenshot-container img {
            max-width: 66.67%;
            height: auto;
            display: block;
            margin: 0 auto;
            background-color: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: zoom-in;
            transition: transform 0.2s ease;
        }

        .screenshot-container img:hover { transform: scale(1.01); }

        pre {
            background: #F3F4F6;
            padding: 1.25rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            border-left: 4px solid var(--sap-blue);
            margin: 2rem 0;
            color: var(--text-dark);
        }

        code {
            font-family: 'Courier New', monospace;
            background: #EEF2F6;
            color: var(--sap-blue);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 500;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
            font-weight: normal;
        }

        /* --- ENHANCED LIGHTBOX (ZOOM) STYLING --- */
        #lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            cursor: zoom-out;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        #lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.3s ease;
        }

        #lightbox img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            cursor: default;
        }

        /* Lightbox Controls */
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 40px;
            color: #ffffff;
            cursor: pointer;
            z-index: 10000;
            transition: transform 0.2s ease;
            font-weight: 300;
            line-height: 1;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-close:hover {
            transform: rotate(90deg);
        }

        .lightbox-prev,
        .lightbox-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 50px;
            color: #ffffff;
            cursor: pointer;
            padding: 20px;
            transition: opacity 0.2s ease;
            user-select: none;
            z-index: 10000;
        }

        .lightbox-prev:hover,
        .lightbox-next:hover {
            opacity: 0.7;
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffffff;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 10000;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { 
                opacity: 0;
                transform: scale(0.8);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Prevent body scroll when lightbox is open */
        body.lightbox-open {
            overflow: hidden;
        }

        /* --- STAY UPDATED SECTION --- */
        .stay-updated {
            margin-top: 3rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .stay-updated-card {
            background: var(--bg-light);
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stay-updated-card h3 {
            color: var(--text-dark);
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stay-updated-card p {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .newsletter-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .newsletter-form input {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s;
        }

        .newsletter-form input:focus {
            outline: none;
            border-color: var(--sap-blue);
            box-shadow: 0 0 0 3px rgba(0, 85, 151, 0.1);
        }

        .btn-subscribe {
            padding: 10px 20px;
            background: var(--sap-blue);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .btn-subscribe:hover {
            background: var(--sap-blue-light);
        }

        .btn-youtube {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 12px 24px;
            background: #ff0000;
            color: #fff;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: background 0.2s ease;
            width: fit-content;
            margin-top: auto;
        }

        .btn-youtube:hover {
            background: #cc0000;
        }

        @media (max-width: 768px) {
            .stay-updated {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        /* --- FOOTER & CTA --- */
        .freelancer-cta {
            margin-top: 6rem;
            padding: 3rem;
            background: var(--bg-light);
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .btn-freelance {
            display: inline-block;
            background: var(--sap-blue);
            color: #fff;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            margin-top: 1rem;
            transition: background 0.2s ease;
        }

        .btn-freelance:hover {
            background: #004276;
        }

        footer { padding: 4rem 10%; text-align: center; font-size: 0.85rem; color: #9CA3AF; border-top: 1px solid var(--border); }
    </style>
</head>
<body>

    <header>
        <a href="../../index.html" class="logo">WM<span>experts</span></a>
        <nav><a href="../../index.html">‚Üê Back to Blog</a></nav>
    </header>

    <article>
        <div class="breadcrumb">Discover SAP EWM MFS</div>
        <h1>The communication from EWM to the PLC</h1>

        <div class="video-wrapper">
            <iframe src="https://www.youtube.com/embed/DaV-p9twI9E" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>

        <div class="content">

            <p>This blog is part of the series ‚Äò<em>SAP EWM meets Automation ‚Äì Discover EWM MFS</em>‚Äô and describes the communication between EWM and the PLC. Specifically, the communication <u>from</u> EWM <u>to</u> the PLC.</p>
            <p>As a practical example I picked the creation and communication of a stock removal warehouse task from an automated storage &amp; retrieval system to describe this communication:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_01.png" alt="SAP EWM MFS PLC communication_01" loading="lazy">
            </div>
            <p>However, the general approach is also applicable for other kinds of telegrams which are being sent from EWM to a subsystem via TCP/IP.<br>Note that with this post we will limit the scope to an APC (ABAP Push-Channel) communication based on the TCP/IP protocol suite. Up to EWM release 9.3 a TCP/IP-RFC converter is required which will not be in scope of this post.</p>
            <p>Also note that the communication steps for the direction from the PLC to EWM will not be part of this post. For everybody who wants to understand how EWM receives telegrams I highly recommend the blog post published by Joerg and Tobias here.</p>
            <p>The content provided here has been created in cooperation with the SAP EWM team at Swisslog. Feel free to visit their <a href="https://www.swisslog.com/en-us/products-systems-solutions/software-inventory-management/sap-ewm-extended-warehouse-management" target="_blank" rel="noopener noreferrer">website</a> in case you want to learn more about the services offered by @ Swisslog or to browse open positions within their EWM team!</p>
            
            <p><strong>Agenda</strong></p>
            <ul>
                <li>Communication protocol</li>
                <li>Preparation of telegram creation</li>
                <li>Telegram creation &amp; transmission<br>As an introduction, let us have a look at the VDI 3962 layer model for computer installations in automated storage systems.</li>
            </ul>
            <p>The red arrow highlights the part of the communication which is in scope of this post:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_02.png" alt="SAP EWM MFS PLC communication_02" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_03.png" alt="SAP EWM MFS PLC communication_03" loading="lazy">
            </div>
            <p>Quick recap at this point ‚Äì<br>In the previous <a href="ewm-plc-integration.html" target="_blank" rel="noopener">blog post</a> we already learned that the queue determination induces the MFS relevance for a given warehouse task. Note that we are talking about task assignment to resources here. Movements within MFS storage types which are not processed by resources could also use EWMs Case Conveyor Routing as an alternative. With this approach it is possible to invoke the communication with the PLC without creating warehouse tasks in MFS-relevant queues upfront. This concept is just mentioned here for the sake of completeness but will not be explained in detail within this blog post (will publish a separate one about CC Routing once I find the time).</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_04.png" alt="SAP EWM MFS PLC communication_04" loading="lazy">
            </div>
            <p>Technically, EWM marks open warehouse tasks for MFS processing via the field <code>KZSUB</code>:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_05.png" alt="SAP EWM MFS PLC communication_05" loading="lazy">
            </div>
            <p>This is being set based on the queue configuration. FM <code>/SCWM/QUEUE_DET_PREP</code> reads the queue customizing from table <code>/SCWM/T346</code>. Here you can see that it is empty in the <code>ltap</code> structure initially and then set to ‚ÄòY‚Äô (~ relevant but not sent to the subsystem yet) based on the constant in line 261 in the screenshot below.</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_06.png" alt="SAP EWM MFS PLC communication_06" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_07.png" alt="SAP EWM MFS PLC communication_07" loading="lazy">
            </div>
            <p>‚Ä¶recap completed.</p>
            <p>At this point, EWM has decided that a given task has to be processed by the subsystem. We assume this to be our initial situation here. So we start with a queue which is<br>- customized as being MFS relevant<br>- carrying multiple WTs in status ‚ÄòY‚Äô (relevant for subsystem but not sent to subsystem yet).</p>
            <p>So how do we get from here to actually have the subsystem receiving one of those tasks?</p>
            <p>The important components are shown in the overview above and described in this post in <a href="ewm-plc-integration.html" target="_blank" rel="noopener">detail</a>. We will now have a step-by-step look at the important technical details of the communication (bear with me if I skipped some that you consider to be important!).<br>Before we start with this deep-dive I would like you to understand the protocol which is responsible to ensure a reliable communication. While EWM is communicating with a subsystem we want to make sure that telegrams of a given channel are processed sequentially. This is realized by the handshake mechanism which is the main pillar of the PLC communication protocol:<br>- The sender sends a telegram and stores is in its outbound buffer in status ‚Äòsent‚Äô but ‚Äònot acknowledged yet‚Äô.<br>- The sender repeats a message sending a telegram as long as it is not acknowledged in a defined period of time (X times every Y seconds)<br>- The next telegram of the given channel is only sent once the previously sent telegram is acknowledged.<br>- The receiver sends an acknowledge message for every message it receives<br>- The receiver processes a message only once (~ only the first time it receives it)</p>
            <p>Analogy ‚Äì<br>Imagine you are trying to communicate with your kids. Those of you having young kids will know that they like to ignore you in case you tell them something they do not like to hear.</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_08.png" alt="SAP EWM MFS PLC communication_08" loading="lazy">
            </div>
            <p>So imagine the handshake mechanism here as an approach where you only proceed with the next sentence once your kid has confirmed that he/she actually heard the previous sentence. As long as he/she ignores you, you will just proceed saying the same thing all over again. Not sure though how we can incorporate the restart of the channel after X attempts in this analogy. However, you might want to think about opening an additional channel and e.g. start communicating via Whatsapp only .</p>
            
            <h2>Step 1: Which WT to be processed?</h2>
            <p>WTs to be processed by resources are assigned to queues. Subsequently, in the first step we need to decide which of the WTs from the given queue is selected as the next one to be processed (~ sent to subsystem). This is done via FM <code>/SCWM/MFS_WT_DET</code>. This FM is called directly in the context of posting the WT creation and WT confirmation to the DB:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_09.png" alt="SAP EWM MFS PLC communication_09" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_10.png" alt="SAP EWM MFS PLC communication_10" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_11.png" alt="SAP EWM MFS PLC communication_11" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_12.png" alt="SAP EWM MFS PLC communication_12" loading="lazy">
            </div>
            <p>The check during the confirmation is required e.g. in case the telegram for a newly created WT cannot be created right away during the initial posting of the new task (e.g. in case the crane for the given source aisle is busy at that point in time).</p>
            <p>The most important steps that EWM executes in FM <code>/SCWM/MFS_WT_DET</code>:</p>
            <p>- execute some checks here (e.g. availability/status of PLC/resources/channel)<br>- decide whether to do interleaving<br>- apply standard sorting.</p>
            <p>Within the queues, EWM sorts ascending based on latest start date, priority and warehouse order number (the logic can be overruled via Badi <code>/SCWM/EX_MFS_WO_DET2</code> and/or <code>/SCWM/EX_MFS_WT_DET</code>):</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_13.png" alt="SAP EWM MFS PLC communication_13" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_14.png" alt="SAP EWM MFS PLC communication_14" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_15.png" alt="SAP EWM MFS PLC communication_15" loading="lazy">
            </div>
            <p>Note that EWM applies some additional checks here depending on the context (e.g. use FM <code>/SCWM/MFS_WT_DET_PREP</code> to check if source location of WT is a communication point and if there are any other HUs on the same CP which have to be processed first). This is not relevant for the first movement in our example but might become relevant later for subsequent steps towards the final destination of the HU which is to be removed from stock here.</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_16.png" alt="SAP EWM MFS PLC communication_16" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_17.png" alt="SAP EWM MFS PLC communication_17" loading="lazy">
            </div>
            <p>Finally we are at the point where the WT to be processed is determined and EWM calls the FM to send the telegram:</p>
                        <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_17_2.png" alt="SAP EWM MFS PLC communication_17" loading="lazy">
            </div>
            
            <h2>Step 2.1: Prepare the telegram creation</h2>
            <p>Once a WT is selected, EWM triggers the creation and transmission of the telegram via function module <code>/SCWM/MFS_SEND</code>. This FM is the most important one from the perspective of this article here and is creating the outgoing telegram from technical perspective.</p>
            <p>Note that this FM is called from multiple other places (e.g. to trigger the creation of an acknowledgement telegram in the context of processing one which had been received from the subsystem). I limited the scope of the post to the context of the creation of a telegram for a warehouse task.</p>
            <p>The FM starts composing telegram content based on the WT data (mainly derived from <code>/SCWM/ORDIM_O</code> table). Note that this happens in case the FM is called directly from the WT creation.</p>
            <p>In other cases (e.g. acknowledgement for received telegram, waiting telegram from <code>MFSDELAY</code> table or resend from warehouse monitor), a telegram does already exist and is imported directly (this scenario is not in scope of this post):</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_18.png" alt="SAP EWM MFS PLC communication_18" loading="lazy">
            </div>
            <p>Then we then we check whether a resource (e.g. a crane operating an ASRS) is involved and whether the resource requires a separate task to confirm the HU to/from the resource itself before it is confirmed to the actual destination of the task. The decision is derived from the resource type customizing:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_19.png" alt="SAP EWM MFS PLC communication_19" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_20.png" alt="SAP EWM MFS PLC communication_20" loading="lazy">
            </div>
            <p>The next important step is the mapping of EWM objects to PLC objects via FM <code>/SCWM/MFS_TELE_MAP</code> which calls <code>/SCWM/MFS_EWM2PLC_OBJ</code> in our context (communication direction EWM &gt; PLC) where EWM reads the mapping data from table <code>/SCWM/MFSOBJMAP</code> (maintained via transaction <code>/SCWM/MFS_OBJMAP</code>):</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_21.png" alt="SAP EWM MFS PLC communication_21" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_22.png" alt="SAP EWM MFS PLC communication_22" loading="lazy">
            </div>
            <p>If needed you can also call Badi <code>/SCWM/EX_MFS_TELE_EWM2PLCOB</code> in this context in order manipulate/provide the mapping between EWM &amp; PLC objects:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_23.png" alt="SAP EWM MFS PLC communication_23" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_24.png" alt="SAP EWM MFS PLC communication_24" loading="lazy">
            </div>
            <p>After the communication channel has been locked successfully, EWM now determines some technical details like telegram type and the communication channel and its parameters/settings. Badi <code>/SCWM/EX_MFS_TELE_CCH_DET</code> could be used here in order to manipulate the determination of the communication channel:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_25.png" alt="SAP EWM MFS PLC communication_25" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_26.png" alt="SAP EWM MFS PLC communication_26" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_27.png" alt="SAP EWM MFS PLC communication_27" loading="lazy">
            </div>
            <p>Finally we call Badi <code>/SCWM/EX_MFS_TELE_SND</code> where we could potentially manipulate telegram data or type:</p>
            <p>If the telegram to be sent does not require an acknowledgement from the subsystem (~ handshake mode) EWM updates <code>KZSUB</code> parameter in the WT already at this point to value ‚ÄòX‚Äô:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_28.png" alt="SAP EWM MFS PLC communication_28" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_29.png" alt="SAP EWM MFS PLC communication_29" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_30.png" alt="SAP EWM MFS PLC communication_30" loading="lazy">
            </div>
            <p>Our telegram is ready to be sent now. Based on the handshake configuration we do now either send it right away or at first check the send buffer (table <code>/SCWM/MFSDELAY</code>) for the given PLC and channel in order to figure out whether there are any other waiting or unconfirmed telegrams (~ telegrams which have been sent to the subsystem but for which EWM did not receive an acknowledgement yet). If telegrams are sitting in the delay table, EWM stores the data for the current telegram in table also in this table but does not send it yet<br>- Sidenote: Upon completion of the waiting telegrams, the receiving process which is processing the acknowledgements (executed via function module <code>/SCWM/MFS_RECEIVE2</code>) picks up our telegram from the buffer and actually sends it ‚Äì again, using FM <code>/SCWM/MFS_SEND</code>:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_32.png" alt="SAP EWM MFS PLC communication_32" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_33.png" alt="SAP EWM MFS PLC communication_33" loading="lazy">
            </div>
            
            <h2>Step 2.2: Create the telegram</h2>
            <p>Let us assume, no waiting telegrams can be found in the buffer table. EWM now sends the current telegram to the subsystem directly. For this purpose we pull a sequence number for the telegram (this is essential for the communication protocol to work) via FM <code>/SCWM/MFS_SND_SEQNO_GET</code>. Based on the sequence number EWM is able to identify a telegram uniquely for a specific period of time (in combination with the channel and the direction). The number is pulled from the channel data, stored in table <code>/SCWM/MFSCCH</code>:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_34.png" alt="SAP EWM MFS PLC communication_34" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_35.png" alt="SAP EWM MFS PLC communication_35" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_36.png" alt="SAP EWM MFS PLC communication_36" loading="lazy">
            </div>
            <p>Note that the way of drawing a sequence number here can be manipulated via Badi <code>/SCWM/EX_MFS_TELE_SEQU_NO</code>.</p>
            <p>As part of the next step, EWM fills the structure of the <u>telegram type</u> (so far we filled a generic structure only) with the local data via FM <code>/SCWM/MFS_MOVETELETOTAL2STR</code> and add filler characters if required.</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_37.png" alt="SAP EWM MFS PLC communication_37" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_38.png" alt="SAP EWM MFS PLC communication_38" loading="lazy">
            </div>
            <p>In case the handshake mechanism is active for the given communication channel, the telegram data is stored in table <code>/SCWM/MFSDELAY</code> even though it is communicated to the subsystem within the next step. This approach allows to retry/resend the telegram in case of errors during the communication (e.g. retry via the <code>MFSPERIOD</code> job in case no acknowledgement has been received after X seconds). In the example from the screenshot below, EWM would resend the telegram every 10 seconds. After the 3rd approach it would close and re-open the channel ahead of the next attempt.</p>
            <p>The record for this telegram will be removed from the buffer table automatically in the context of processing the acknowledgement for the given telegram sequence number from the subsystem.</p>
            <p>The last step before we finally send the telegram is the activation of the log respectively to log the telegram data based on the given settings.</p>
            
            <h2>Step 2.3: Send the telegram</h2>
            <p>Now we finally handover the telegram to the PLC based on the given communication method. This is done via FM <code>/SCWM/MFS_CL_CALL</code>. As part of this FM we first determine the communication details of the PLC (1) and the channel (2):</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_39.png" alt="SAP EWM MFS PLC communication_39" loading="lazy">
            </div>
            <p>Based on the communication channel application data we determine technical details about the destination we are about to talk to (IP address / host &amp; port):</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_40.png" alt="SAP EWM MFS PLC communication_40" loading="lazy">
            </div>
            <p>Based on the PLC application data we know whether we communicate with a middleware/RFC-converter like PlantConnectivity, a proprietary communication layer (e.g. an emulation) or directly with the subsystem via ABAP Push Channel (APC):</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_41.png" alt="SAP EWM MFS PLC communication_41" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_42.png" alt="SAP EWM MFS PLC communication_42" loading="lazy">
            </div>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_43.png" alt="SAP EWM MFS PLC communication_43" loading="lazy">
            </div>
            <p>As mentioned at the beginning of this article, the APC approach is in scope of this article. In this context, class <code>/SCWM/CL_APC_EXT_MFS_TCP_PLC</code> is called to execute the TCP/IP based communication with the subsystem:</p>
            <p>I decided to stop at this point and will not dig deeper into the details. From here onwards it is all about complex technical stuff in order to enable and execute the TCP/IP based communication. Not necessary to understand from my point of view, unless you want to become a MFS core developer or need to change/analyse something in this area of the coding (which should rarely happen as part of your MFS projects).<br>You should understand though, that the subsystem will send an acknowledgement telegram back to EWM and stores the telegram in its receiving buffer, before it actually processes it.</p>
            
            <h2>Step 3: Check whether we already received something</h2>
            <p>At the very end of our Send-FM EWM tries to process the answer from the subsystem right away via FM <code>/SCWM/MFS_RECEIVE2</code>:</p>
            <div class="screenshot-container">
                <img src="..\..\assets\images\mfs\ewm-plc/SAP EWM MFS PLC communication_44.png" alt="SAP EWM MFS PLC communication_44" loading="lazy">
            </div>
            <p>I stop here with a hint the blog <a href="https://blogs.sap.com/2020/11/23/sap-ewm-mfs-receiving-and-processing-telegrams/" target="_blank" rel="noopener">post</a> of Joerg and Tobias, where they will unveil the details of the logic to process incoming telegrams.</p>
            
            <h2>Side note</h2>
            <p>I mentioned the Telegram Repetition Process via the Batch Job <code>MFS_PERIODCHECK</code> multiple times in this article. This job (respectively report: <code>/SCWM/R_MFS_PERIODCHK_PREP</code> / FM: <code>/SCWM/MFS_PERIODCHK</code>) is an essential component of the MFS logic and is mainly responsible to monitor the connections and trigger the repetition of telegrams. It is</p>
            <ul>
                <li>responsible for all channels within warehouse number</li>
                <li>started automatically when a channel is started (via the warehouse monitor)</li>
                <li>stopped automatically when all channels are stopped (after timeout)</li>
                <li>sending LIFE check telegrams on timeout</li>
                <li>checking for outstanding acknowledgement telegrams</li>
                <li>repeating telegrams n times with the same sequence number before it closes and reopens the channel</li>
            </ul>
            
            <h2>Summary</h2>
            <p>You should have a rough understanding about how EWM sends telegrams to subsystems like crane or conveyor PLCs. As an example we looked at the creation and communication of a telegram for a warehouse task which removes an HU from a ASRS. We saw how EWM decides whether a task is relevant for the subsystem and how it decides which task of a given queue is the next one to be processed. We learned how the telegram is created, buffered and finally pushed out of EWM to its destination.</p>
        </div>

        <!-- STAY UPDATED SECTION -->
        <div class="stay-updated">
            <!-- Newsletter Card -->
            <div class="stay-updated-card">
                <div>
                    <h3>üìß Newsletter</h3>
                    <p>Get updates about new blog posts directly in your inbox.</p>
                </div>
                <form action="https://online.us17.list-manage.com/subscribe/post?u=3dbafeb5441a290b4bfdeeb38&id=226759b4e6&f_id=00e24be0f0" method="post" class="newsletter-form" target="_blank" rel="noopener noreferrer">
                    <input type="email" name="EMAIL" placeholder="Your email" required>
                    <input type="text" name="FNAME" placeholder="First name (optional)">
                    <input type="text" name="LNAME" placeholder="Last name (optional)">
                    <input type="text" name="b_3dbafeb5441a290b4bfdeeb38_226759b4e6" style="display: none;" tabindex="-1">
                    <button type="submit" class="btn-subscribe">Subscribe</button>
                </form>
            </div>

            <!-- YouTube Card -->
            <div class="stay-updated-card">
                <div>
                    <h3>‚ñ∂Ô∏è YouTube Channel</h3>
                    <p>Subscribe to my channel for regular tutorials & insights about SAP EWM.</p>
                </div>
                <a href="https://www.youtube.com/@sapewm?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="btn-youtube">Subscribe on YouTube</a>
            </div>
        </div>

        <div class="freelancer-cta">
            <p><strong>Need EWM expertise within your project?</strong><br>
            WMexperts.online is a knowledge-sharing project of Hendrik, a Senior SAP EWM Freelancer.</p>
            <a href="#" class="btn-freelance">Explore my Freelance Profile ‚Üí</a>
        </div>
    </article>

    <!-- ENHANCED LIGHTBOX OVERLAY -->
    <div id="lightbox">
        <span class="lightbox-close" id="lightbox-close">&times;</span>
        <span class="lightbox-prev" id="lightbox-prev">&#8249;</span>
        <span class="lightbox-next" id="lightbox-next">&#8250;</span>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="">
        </div>
        <div class="lightbox-counter" id="lightbox-counter"></div>
    </div>

    <footer>&copy; 2026 WMexperts.online ‚Ä¢ Functional & Technical SAP EWM Expertise</footer>

    <!-- ENHANCED LIGHTBOX JAVASCRIPT -->
    <script>
        (function() {
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxPrev = document.getElementById('lightbox-prev');
            const lightboxNext = document.getElementById('lightbox-next');
            const lightboxCounter = document.getElementById('lightbox-counter');
            
            // Get all images that should be zoomable
            const images = document.querySelectorAll('.screenshot-container img, .content img');
            let currentImageIndex = 0;

            // Add click event to all images
            images.forEach((img, index) => {
                img.addEventListener('click', function() {
                    openLightbox(index);
                });
            });

            function openLightbox(index) {
                currentImageIndex = index;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                lightbox.classList.add('active');
                document.body.classList.add('lightbox-open');
                updateCounter();
                
                // Show/hide navigation arrows based on number of images
                if (images.length <= 1) {
                    lightboxPrev.style.display = 'none';
                    lightboxNext.style.display = 'none';
                } else {
                    lightboxPrev.style.display = 'block';
                    lightboxNext.style.display = 'block';
                }
            }

            function closeLightbox() {
                lightbox.classList.remove('active');
                document.body.classList.remove('lightbox-open');
            }

            function showPrevImage() {
                currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                updateCounter();
            }

            function showNextImage() {
                currentImageIndex = (currentImageIndex + 1) % images.length;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                updateCounter();
            }

            function updateCounter() {
                if (images.length > 1) {
                    lightboxCounter.textContent = `${currentImageIndex + 1} / ${images.length}`;
                    lightboxCounter.style.display = 'block';
                } else {
                    lightboxCounter.style.display = 'none';
                }
            }

            // Event listeners
            lightboxClose.addEventListener('click', function(e) {
                e.stopPropagation();
                closeLightbox();
            });

            lightboxPrev.addEventListener('click', function(e) {
                e.stopPropagation();
                showPrevImage();
            });

            lightboxNext.addEventListener('click', function(e) {
                e.stopPropagation();
                showNextImage();
            });

            // Click on overlay background to close
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (!lightbox.classList.contains('active')) return;
                
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft') {
                    showPrevImage();
                } else if (e.key === 'ArrowRight') {
                    showNextImage();
                }
            });

            // Prevent image content click from closing lightbox
            lightboxImg.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        })();
    </script>

</body>
</html>
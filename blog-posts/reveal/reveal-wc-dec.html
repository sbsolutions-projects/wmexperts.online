<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="In-depth article about SAP EWM. Learn technical and functional details about Work center determination for a deconsolidation process.">
    <meta name="keywords" content="SAP EWM, Warehouse Management, Deconsolidation, Work Center Determination, POSC">
    <meta name="author" content="Hendrik">
    <link rel="icon" type="image/png" href="../../assets/favicon/wmexperts%20favicon.png">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Work center determination for a deconsolidation process | WMexperts">
    <meta property="og:description" content="In-depth article about SAP EWM. Learn technical and functional details about Work center determination for a deconsolidation process.">
    <meta property="article:published_time" content="2024-01-01">
    <meta property="article:modified_time" content="2024-01-01">

    <!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "BlogPosting",
  "headline": "Work center determination for a deconsolidation process",
  "description": "In-depth article about SAP EWM. Learn technical and functional details about Work center determination for a deconsolidation process.",
  "image": "../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_01.png",
  "datePublished": "2024-01-01T00:00:00Z",
  "dateModified": "2024-01-01T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Hendrik"
  },
  "publisher": {
    "@type": "Organization",
    "name": "WMexperts",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wmexperts.online/assets/favicon/favicon-32x32.png"
    }
  }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://wmexperts.online/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Reveal SAP EWM",
      "item": "https://wmexperts.online/blog-posts/reveal/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Work center determination for a deconsolidation process",
      "item": "https://wmexperts.online/blog-posts/reveal/reveal-wc-dec.html"
    }
  ]
}
</script>

    <title>Work center determination for a deconsolidation process | WMexperts</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --sap-blue: #005597;
            --bg-light: #F9FAFB;
            --text-dark: #111827;
            --text-muted: #4B5563;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--text-muted);
            margin: 0;
            line-height: 1.8;
        }

        /* --- NAVIGATION --- */
        header {
            background: #fff;
            padding: 1rem 10%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { font-weight: 700; font-size: 1.5rem; color: var(--sap-blue); text-decoration: none; }
        .logo span { color: var(--sap-blue); }
        nav a { text-decoration: none; color: var(--text-muted); font-size: 0.9rem; font-weight: 600; }

        /* --- ARTICLE STRUCTURE --- */
        article { max-width: 800px; margin: 4rem auto; padding: 0 20px; }

        .breadcrumb {
            font-size: 0.75rem;
            color: var(--sap-blue);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        h1 { font-size: 2.8rem; color: var(--text-dark); line-height: 1.2; margin-bottom: 1.5rem; letter-spacing: -1px; }

        /* --- RESPONSIVE VIDEO CONTAINER --- */
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            margin: 2.5rem 0;
            border-radius: 12px;
            background: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .content p { margin-bottom: 0.75rem; font-size: 1.1rem; }
        .content h2 { color: var(--text-dark); margin-top: 1.75rem; font-size: 1.8rem; border-bottom: 2px solid var(--bg-light); padding-bottom: 0.5rem; }
        .content ul { padding-left: 1.5rem; margin-bottom: 2rem; }
        .content li { margin-bottom: 0.75rem; font-size: 1.05rem; }

        /* --- TECHNICAL & IMAGE BLOCKS --- */
        .screenshot-container { margin: 1.75rem 0; text-align: center; }
        
        .screenshot-container img {
            max-width: 66.67%;
            height: auto;
            display: block;
            margin: 0 auto;
            background-color: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: zoom-in;
            transition: transform 0.2s ease;
        }

        .screenshot-container img:hover { transform: scale(1.01); }

        pre {
            background: #F3F4F6;
            padding: 1.25rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            border-left: 4px solid var(--sap-blue);
            margin: 2rem 0;
            color: var(--text-dark);
        }

        code {
            font-family: 'Courier New', monospace;
            background: #EEF2F6;
            color: var(--sap-blue);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 500;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
            font-weight: normal;
        }

        /* --- ENHANCED LIGHTBOX (ZOOM) STYLING --- */
        #lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            cursor: zoom-out;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        #lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.3s ease;
        }

        #lightbox img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            cursor: default;
        }

        /* Lightbox Controls */
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 40px;
            color: #ffffff;
            cursor: pointer;
            z-index: 10000;
            transition: transform 0.2s ease;
            font-weight: 300;
            line-height: 1;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-close:hover {
            transform: rotate(90deg);
        }

        .lightbox-prev,
        .lightbox-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 50px;
            color: #ffffff;
            cursor: pointer;
            padding: 20px;
            transition: opacity 0.2s ease;
            user-select: none;
            z-index: 10000;
        }

        .lightbox-prev:hover,
        .lightbox-next:hover {
            opacity: 0.7;
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffffff;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 10000;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { 
                opacity: 0;
                transform: scale(0.8);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Prevent body scroll when lightbox is open */
        body.lightbox-open {
            overflow: hidden;
        }

        /* --- STAY UPDATED SECTION --- */
        .stay-updated {
            margin-top: 3rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .stay-updated-card {
            background: var(--bg-light);
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stay-updated-card h3 {
            color: var(--text-dark);
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stay-updated-card p {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .newsletter-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .newsletter-form input {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s;
        }

        .newsletter-form input:focus {
            outline: none;
            border-color: var(--sap-blue);
            box-shadow: 0 0 0 3px rgba(0, 85, 151, 0.1);
        }

        .btn-subscribe {
            padding: 10px 20px;
            background: var(--sap-blue);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .btn-subscribe:hover {
            background: var(--sap-blue-light);
        }

        .btn-youtube {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 12px 24px;
            background: #ff0000;
            color: #fff;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: background 0.2s ease;
            width: fit-content;
            margin-top: auto;
        }

        .btn-youtube:hover {
            background: #cc0000;
        }

        @media (max-width: 768px) {
            .stay-updated {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        /* --- FOOTER & CTA --- */
        .freelancer-cta {
            margin-top: 6rem;
            padding: 3rem;
            background: var(--bg-light);
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .btn-freelance {
            display: inline-block;
            background: var(--sap-blue);
            color: #fff;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            margin-top: 1rem;
            transition: background 0.2s ease;
        }

        .btn-freelance:hover {
            background: #004276;
        }

        footer { padding: 4rem 10%; text-align: center; font-size: 0.85rem; color: #9CA3AF; border-top: 1px solid var(--border); }
    </style>
</head>
<body>

    <header>
        <a href="../../index.html" class="logo" target="_blank">WM<span style="color: var(--text-dark);">experts.online</span></a>
        <nav><a href="../../index.html" target="_blank">← Back to Blog</a></nav>
    </header>

    <article>
        <div class="breadcrumb">Reveal SAP EWM</div>
        <h1>Work center determination for a deconsolidation process</h1>

        <div class="video-wrapper">
            <iframe src="https://www.youtube-nocookie.com/embed/IQaWR85Jr4k" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>

        <div class="content">
            <p>This blog reveals the logic for destination bin / work center determination in a deconsolidation step as part of an inbound storage process. Having said that, it should be obvious that we are looking into inbound processes using the process-oriented storage control in order to model the physical flow &amp; steps.</p>
            
            <p>Note that I will not share a detailed explanation here about the deconsolidation process as such, but rather focus on the work center and/or bin determination for this step. I am recommending <a href="https://blogs.sap.com/2020/01/06/sap-ewm-deconsolidation-process/" target="_blank" rel="noopener">this blog</a> here from Nitin Solan for those who want to make themselves familiar with the general functionality here upfront.</p>
            
            <p>Before we look at the Agenda for this post, I would like to highlight one funny thing, that I noticed while reading the code. Some EWM standard constants and programming objects are referring to ‘spreading’ instead of ‘deconsolidating’ in the context we are talking about here. You might notice that in some of the screenshots below. Never heard that term before - seems they dropped it at some point and replaced it by ‘deconsolidation’. Maybe just ‘party knowledge’ but I think it kind of helps to understand the logic as we are actually ‘deconsolidating’ in case the goods will later be ‘spread’ into different areas of the warehouse. This is why I thought it would be worth sharing it here:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_01.png" alt="SAP EWM work center determination for deconsolidation_01" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_02.png" alt="SAP EWM work center determination for deconsolidation_02" loading="lazy">
            </div>
            
            <p>Enough for the introduction – let us look at the structure of this article.</p>
            
            <p><strong>Agenda</strong><br />- Rules-based vs. non-rules-based determination<br />- Deep-dive into the logic<br />- Option for enhancements</p>
            
            <strong>Rules-based vs. non-rules-based determination</strong>
            
            <p>In general, we can separate the options for the bin determination as part of the process-oriented storage control into rules-based and non-rules-based ones.</p>
            
            <p>As for the deconsolidation, the rules-based flags will be used to determine the destination which is needed to complete the previous step (so e.g. a record with <code>IB02</code> will set the destination for step <code>IB01</code>).<br />Alternatively, you can use the rather fixed, pre-given destination (storage type, section and bins) that you can maintain in each external step.</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_03.png" alt="SAP EWM work center determination for deconsolidation_03" loading="lazy">
            </div>
            
            <p>The standard help text is very – let’s say ‘lean’ here:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_04.png" alt="SAP EWM work center determination for deconsolidation_04" loading="lazy">
            </div>
            
            <p>Based on this we know now that a rules-based determination of the destination data can be used for our deconsolidation step. Honestly – that help text here does not help at all. At least not when you are just starting your EWM journey.<br>Thus – the perfect feature for my blog series 'Reveal SAP EWM'. Within the following paragraphs I give you an in-depth technical review for the usage of this flag for internal process steps of the type ‘deconsolidate’.</p>
            
            <strong>Deep-dive into the determination logic</strong>
            
            <p>The non-rules based option is the easy one of course. As mentioned above, you only need to maintain the destination data in the POSC customizing for the given step and it will be fixed for all HUs which fulfill the key-criteria:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_05.png" alt="SAP EWM work center determination for deconsolidation_05" loading="lazy">
            </div>
            
            <p>The rules-based option is the more interesting one -<br />Function module <code>/SCWM/STORAGE_CONTROL_P_GET</code> is the most important player for all kind of rules-based bin determination (no matter whether we are talking about deconsolidation or any other step type).</p>
            
            <p>In case the rules-based flag is set for a deconsolidation (~spreading) step, EWM first (1) collects all product warehouse tasks having the given source HU. With this step EWM is preparing the relevance-check. Note that EWM will also consider tasks for all sub-HUs here. The logic is sitting in FM <code>/SCWM/TO_GET_ROUTE_MAT_TO</code>:<br />- the FM reads all sub-HUs for the given top-HU<br />- reads all open product WTs with one of those HUs as source HU<br />- determines the destination activity area for each of those tasks based on the destination bin and the activity type from the WPT<br />- returns the result</p>
            
            <p>In the second step (2) – in case it could find product-WT(s) for the given HU(s) - it evaluates the deconsolidation rules via FM <code>/SCWM/SPREADING_RULES_EVALUATE</code>, in order to return a destination type, section and bin. So in this step EWM is actually executing the relevance-check:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_06.png" alt="SAP EWM work center determination for deconsolidation_06" loading="lazy">
            </div>
            
            <p>FM <code>/SCWM/SPREADING_RULES_EVALUATE</code> executes the following logic –</p>
            
            <p>At first it checks whether deconsolidation is necessary at all, based on the enriched list of WTs returned from the first FM mentioned above (product WTs for our HU &amp; sub-HU(s)). This is done via subroutine <code>spreading_check</code>:<br />- Do we have tasks/products with different quality inspection types (e.g. one product is relevant for sampling and one is not)? If yes, deconsolidation is relevant<br />- Do the WTs point towards different activity areas? If yes, deconsolidation is relevant<br />- Do the WTs point towards storage bins with different deconsolidation groups? If yes, deconsolidation is relevant<br />- Do we have more than one WT and is one of the WTs moving preallocated stock? If yes, deconsolidation is relevant<br />- In case none of the above is true, EWM makes one last check, comparing the number of WTs for the given source HU against the maximum per HU for the given activity area (threshold can be set via deconsolidation customizing)? If equal or bigger, deconsolidation is relevant</p>
            
            <p>In case deconsolidation turns out not to be relevant, we return from here and skip the step of the given storage process (e.g. provide the final putaway destination of the HU right after the unloading process step).</p>
            
            <p>In case deconsolidation turns out to be relevant, EWM tries to determine a work center as a destination to execute the deconsolidation step. This is done via subroutine <code>spreading_station_determine</code>:</p>
            
            <p>- It first determines the HU type group for the given HU as well as the source storage type (e.g. the staging bin or one from the door bin in case the HU is moved from a TU directly)<br />- Then it uses this data to read the deconsolidation work center determination table:<br />1. first time fully qualified<br />2. second time without the destination activity area<br />3. third time without storage type<br />4. fourth time without storage type &amp; activity area:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_07.png" alt="SAP EWM work center determination for deconsolidation_07" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_08.png" alt="SAP EWM work center determination for deconsolidation_08" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_09.png" alt="SAP EWM work center determination for deconsolidation_09" loading="lazy">
            </div>
            
            <p>If one of the selects returned a unique result (exactly one matching record) it either returns the work station type and bin (1) (in case the record holds a work station > EWM reads the work station bin from its master data table <code>/SCWM/TWORKST</code>) or it returns the specific type, section and bin (2) (in case the record does not hold a work station):</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_11.png" alt="SAP EWM work center determination for deconsolidation_11" loading="lazy">
            </div>
            
            <p>In case the subroutine could not find any matching record in the customizing table, it returns an error and does not create a task at all. The step is not being skipped here because deconsolidation had already been determined as being relevant. As mentioned above, skipping the step is only possible in case deconsolidation is found not to be relevant, based on the logic in FM <code>/SCWM/SPREADING_RULES_EVALUATE</code> (the FM returns its export parameters with initial values):</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_10.png" alt="SAP EWM work center determination for deconsolidation_10" loading="lazy">
            </div>
            
            <p>Note that in case the rules-based flag is not set, the deconsolidation step is always relevant. In this case, EWM will try to read the destination data for the previous step from the customizing of the POSC deconsolidation step and throw an error in case it could not find any.</p>
            
            <strong>Options for enhancements</strong>
            <p>In case what I described above is not sufficient to cover your requirements, you can use BAdI <code>/SCWM/EX_WRKC_DECON_DET</code> to potentially add a custom logic for the work center determination. With this BAdI you could overrule the error flag mentioned before and provide a destination based on your own rules:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/wc-det-deco/SAP EWM work center determination for deconsolidation_12.png" alt="SAP EWM work center determination for deconsolidation_12" loading="lazy">
            </div>
            
            <strong>Closure</strong>
            <p>...nothing left to say. Hope you learned something new. At least the fact that ‘deconsolidation’ has once been ‘spreading’… ;-)</p>

        </div>

        <!-- STAY UPDATED SECTION -->
        <div class="stay-updated">
            <!-- Newsletter Card -->
            <div class="stay-updated-card">
                <div>
                    <h3>📧 Newsletter</h3>
                    <p>Get updates about new blog posts directly in your inbox.</p>
                </div>
                <form action="https://online.us17.list-manage.com/subscribe/post?u=3dbafeb5441a290b4bfdeeb38&id=226759b4e6&f_id=00e24be0f0" method="post" class="newsletter-form" target="_blank" rel="noopener noreferrer">
                    <input type="email" name="EMAIL" placeholder="Your email" required>
                    <input type="text" name="FNAME" placeholder="First name (optional)">
                    <input type="text" name="LNAME" placeholder="Last name (optional)">
                    <input type="text" name="b_3dbafeb5441a290b4bfdeeb38_226759b4e6" style="display: none;" tabindex="-1">
                    <button type="submit" class="btn-subscribe">Subscribe</button>
                </form>
            </div>

            <!-- YouTube Card -->
            <div class="stay-updated-card">
                <div>
                    <h3>▶️ YouTube Channel</h3>
                    <p>Subscribe to my channel for regular tutorials & insights about SAP EWM.</p>
                </div>
                <a href="https://www.youtube.com/@sapewm?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="btn-youtube" >Subscribe on YouTube</a>
            </div>
        </div>

        <div class="freelancer-cta">
            <p><strong>Need EWM expertise within your project?</strong><br>
            WMexperts.online is a knowledge-sharing project of Hendrik, a Senior SAP EWM Freelancer.</p>
            <a href="#" class="btn-freelance" target="_blank">Explore my Freelance Profile →</a>
        </div>
    </article>

    <!-- ENHANCED LIGHTBOX OVERLAY -->
    <div id="lightbox">
        <span class="lightbox-close" id="lightbox-close">&times;</span>
        <span class="lightbox-prev" id="lightbox-prev">&#8249;</span>
        <span class="lightbox-next" id="lightbox-next">&#8250;</span>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="">
        </div>
        <div class="lightbox-counter" id="lightbox-counter"></div>
    </div>

    <footer>&copy; 2026 WMexperts.online • Functional & Technical SAP EWM Expertise</footer>

    <!-- ENHANCED LIGHTBOX JAVASCRIPT -->
    <script>
        (function() {
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxPrev = document.getElementById('lightbox-prev');
            const lightboxNext = document.getElementById('lightbox-next');
            const lightboxCounter = document.getElementById('lightbox-counter');
            
            // Get all images that should be zoomable
            const images = document.querySelectorAll('.screenshot-container img, .content img');
            let currentImageIndex = 0;

            // Add click event to all images
            images.forEach((img, index) => {
                img.addEventListener('click', function() {
                    openLightbox(index);
                });
            });

            function openLightbox(index) {
                currentImageIndex = index;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                lightbox.classList.add('active');
                document.body.classList.add('lightbox-open');
                updateCounter();
                
                // Show/hide navigation arrows based on number of images
                if (images.length <= 1) {
                    lightboxPrev.style.display = 'none';
                    lightboxNext.style.display = 'none';
                } else {
                    lightboxPrev.style.display = 'block';
                    lightboxNext.style.display = 'block';
                }
            }

            function closeLightbox() {
                lightbox.classList.remove('active');
                document.body.classList.remove('lightbox-open');
            }

            function showPrevImage() {
                currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                updateCounter();
            }

            function showNextImage() {
                currentImageIndex = (currentImageIndex + 1) % images.length;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                updateCounter();
            }

            function updateCounter() {
                if (images.length > 1) {
                    lightboxCounter.textContent = `${currentImageIndex + 1} / ${images.length}`;
                    lightboxCounter.style.display = 'block';
                } else {
                    lightboxCounter.style.display = 'none';
                }
            }

            // Event listeners
            lightboxClose.addEventListener('click', function(e) {
                e.stopPropagation();
                closeLightbox();
            });

            lightboxPrev.addEventListener('click', function(e) {
                e.stopPropagation();
                showPrevImage();
            });

            lightboxNext.addEventListener('click', function(e) {
                e.stopPropagation();
                showNextImage();
            });

            // Click on overlay background to close
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (!lightbox.classList.contains('active')) return;
                
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft') {
                    showPrevImage();
                } else if (e.key === 'ArrowRight') {
                    showNextImage();
                }
            });

            // Prevent image content click from closing lightbox
            lightboxImg.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        })();
    </script>

</body>
</html>








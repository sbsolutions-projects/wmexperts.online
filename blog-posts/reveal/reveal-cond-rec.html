<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="In-depth article about SAP EWM. Learn technical and functional details about [Topic].">
    <meta name="keywords" content="SAP EWM, Warehouse Management, [Topic Keywords]">
    <meta name="author" content="Hendrik">
    <link rel="icon" type="image/png" href="/assets/favicon/wmexperts%20favicon.png">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Article Title | WMexperts">
    <meta property="og:description" content="In-depth article about SAP EWM. Learn technical and functional details about [Topic].">
    <meta property="article:published_time" content="2023-06-17">
    <meta property="article:modified_time" content="2023-06-17">

    <!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "BlogPosting",
  "headline": "Article Title",
  "description": "In-depth article about SAP EWM. Learn technical and functional details about [Topic].",
  "image": "../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_01.png",
  "datePublished": "2023-06-17T00:00:00Z",
  "dateModified": "2023-06-17T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Hendrik"
  },
  "publisher": {
    "@type": "Organization",
    "name": "WMexperts",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wmexperts.online/assets/favicon/favicon-32x32.png"
    }
  }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://wmexperts.online/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Reveal SAP EWM",
      "item": "https://wmexperts.online/blog-posts/reveal/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Article Title",
      "item": "https://wmexperts.online/blog-posts/reveal/reveal-cond-rec.html"
    }
  ]
}
</script>

    <title>Article Title | WMexperts</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>

    <header id="main-header"></header>

    <article>
        <div class="breadcrumb">Reveal SAP EWM</div>
        <h1>Condition record determination for PPF actions</h1>

        <div class="video-wrapper">
            <iframe src="https://www.youtube-nocookie.com/embed/9K_ZfJ8GlXM" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>

        <div class="content">
            <p>Within this blog post I take a look into the technical part of condition record determination for PPF action schedule and start conditions. So on a high-level I will basically answer the question about how to get from a condition record to a scheduled or executed action?</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_01.png" alt="SAP EWM PPF condition records_01" loading="lazy">
            </div>
            
            <p>As a practical example I decided to take the determination in the context of action conditions for delivery documents. A very similar approach is valid for any other PPF application in EWM which is using condition records in order to schedule or start its actions (e.g. actions on Handling Unit, Physical Inventory Document or Warehouse Order -level in the area of the ‘Warehouse Management Engine’).</p>
            
            <p>You can expect answers to the following technical questions within this blog post:</p>
            <ul>
                <li>Where does EWM call the condition record determination (some examples)?</li>
                <li>What needs to be done in order to implement a custom logic to consider additional fields?</li>
                <li>How does EWM compare the given object with the given condition records?</li>
            </ul>
            
            <p>Logical flow of the process that I will tackle within this post:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_02.png" alt="SAP EWM PPF condition records_02" loading="lazy">
            </div>
            
            <p>Condition records in the context of PPF actions in EWM are being evaluated for schedule and start conditions. As the name says – these conditions decide whether a given action is to be scheduled at all and whether it should be executed right away or not. The logic behind those conditions is defined via implementations of the BAdi <code>EVAL_SCHEDCOND_PPF</code> (for schedule conditions) and <code>EVAL_STARTCOND_PPF</code> (for start conditions) respectively:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_03.png" alt="SAP EWM PPF condition records_03" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_04.png" alt="SAP EWM PPF condition records_04" loading="lazy">
            </div>
            
            <p><u>Important</u>: Not only Z-conditions but also all standard conditions are delivered as implementations of those BAdis. E.g. SAP standard delivers around 90 classes using the interface of the scheduling BAdi:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_05.png" alt="SAP EWM PPF condition records_05" loading="lazy">
            </div>
            
            <p>As mentioned above, with this blog post I want to focus on how EWM implements conditions based on condition records. For this purpose it is neither relevant whether those records are evaluated in the context of a schedule or a start conditions. Nor is it relevant whether those records are being evaluated in the context of scheduling for the application area of ‘Warehouse Requests’, ‘Warehouse Management Engine’ or any other area. Of course the approach of collecting data ahead of reading the condition tables is slightly different but I will come to this once we reach that point. For now, let us concentrate on our example in the context of <u>scheduling an action for a warehouse request</u>.</p>
            
            <p>We take the action for the automatic GR posting of inbound deliveries. Via transaction <code>SPPFCADM</code> we can find a filter value which is assigned to a PPF action. The filter is used during runtime in order to determine the relevant implementation of the BAdis shown above (so in case you want to implement your own scheduling logic, you only need to create a new implementation of the BAdi and assign a different filter value here):</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_06.png" alt="SAP EWM PPF condition records_06" loading="lazy">
            </div>
            
            <p>Let us now have a detailed look at one standard implementation in order to understand how EWM evaluates the condition records:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_07.png" alt="SAP EWM PPF condition records_07" loading="lazy">
            </div>
            
            <p>Both (scheduling &amp; start condition) use the same method to read the condition technique customizing. In the context of deliveries/warehouse requests this is class/method <code>/SCWM/CL_DLV_PPF_CONF-EVALUATE</code>:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_08.png" alt="SAP EWM PPF condition records_08" loading="lazy">
            </div>
            
            <p>There are lots of other examples for implementations where this method is being called but the one above should be enough for now to have a good understanding of the context. So what is our <code>EVALUATE</code> method actually doing here?</p>
            
            <p>Looking at it from the outside, this method is responsible to fill its return variable <code>rv_cv</code>. The variable is filled based on the result of the condition record determination in the following way:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_09.png" alt="SAP EWM PPF condition records_09" loading="lazy">
            </div>
            
            <p>Subsequently, it decides about the value of the exporting parameter in the interface method of our BAdi:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_10.png" alt="SAP EWM PPF condition records_10" loading="lazy">
            </div>
            
            <p>That should be understandable already for everybody who has been in touch with the condition technique in the past. Let us now look at it from the inside – time for a code-review!</p>
            
            <p><u>Read the condition technique customizing</u></p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_11.png" alt="SAP EWM PPF condition records_11" loading="lazy">
            </div>
            
            <p>The most important settings here are the determination procedure and the relevant search fields.</p>
            <ul>
                <li>The determination procedure is required in order to determine the condition types</li>
                <li>The condition types are required in order to determine the access sequences</li>
                <li>The access sequences carry the condition tables and the relevant search fields</li>
            </ul>
            
            <p>And those search fields need to be determined upfront in order to prepare the respective values for the given object (e.g. the document type of a warehouse request) so that these values can later be compared with values from the condition records.</p>
            
            <p>The data is determined via the methods <code>get_detproc</code> and <code>get_searchfields</code>:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_12.png" alt="SAP EWM PPF condition records_12" loading="lazy">
            </div>
            
            <p>The two constants in line 86 and 103 might set the return variable to 1 or 4 respectively, in case one of the methods did not return any result (~ no determination procedure assigned to the given warehouse request type or no search fields found based on the determination procedure).</p>
            
            <p>So how do we make sure that we get a result here? Let us take a look into the corresponding customizing:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_13.png" alt="SAP EWM PPF condition records_13" loading="lazy">
            </div>
            
            <p>As mentioned above already:</p>
            <ul>
                <li>The determination procedure is required in order to determine the condition types</li>
                <li>The condition types are required in order to determine the access sequences</li>
                <li>The access sequences carry the condition tables and the search fields</li>
            </ul>
            
            <p>For deliveries, the determination procedure is determined based on the action itself and the document data (category &amp; type):</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_13.png" alt="SAP EWM PPF condition records_13 (2)" loading="lazy">
            </div>
            
            <p>The condition types are assigned to the determination procedure and each condition type gets an access sequence:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_14.png" alt="SAP EWM PPF condition records_14" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_15.png" alt="SAP EWM PPF condition records_15" loading="lazy">
            </div>
            
            <p>And the search fields are being determined based on the combination of access sequence and condition table:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_16.png" alt="SAP EWM PPF condition records_16" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_17.png" alt="SAP EWM PPF condition records_17" loading="lazy">
            </div>
            
            <p><u>Determine the data for the search field based on the given object / delivery</u></p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_18.png" alt="SAP EWM PPF condition records_18" loading="lazy">
            </div>
            
            <p>We now know the relevant search fields so we need to fill them with data related to our object (e.g. the respective delivery document) in order to compare this with the values in the condition records later.</p>
            
            <p>In the context of warehouse request condition evaluation this is done via method <code>CREATE_REQUESTS</code> of our class <code>/SCWM/CL_DLV_PPF_CONF</code>:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_19.png" alt="SAP EWM PPF condition records_19" loading="lazy">
            </div>
            
            <p>EWM standard collects the following data about our object here:</p>
            <ul>
                <li>Type &amp; category</li>
                <li>Warehouse number</li>
                <li>Source/destination partner/locations</li>
                <li>Means of transport</li>
                <li>Door (if unique for all items)</li>
                <li>Goods movement bin (if unique for all items)</li>
                <li>Statuses</li>
            </ul>
            
            <p>Important to highlight here is the technical difference between the way of reading the statuses between scheduling and start conditions. </p>
            
            <p>Start condition: method <code>get_statuses</code></p>
            
            <p>Schedule condition: method <code>get_status_flips</code></p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_20.png" alt="SAP EWM PPF condition records_20" loading="lazy">
            </div>
            
            <p><em>From technical point of view, there is a big difference between the schedule and start condition. On the one hand, schedule conditions use data from memory and are evaluated before the main process updates the database from the memory. On the other hand, start conditions are evaluated when the database is already updated and they use data from there. (SAP Note 1461585)</em></p>
            
            <p>Thus, checking the schedule conditions means checking the transient object states. Checking the start conditions means checking the persistent object states. Schedule conditions use status changes, which are calculated from the status in the database and the status in the memory. Start conditions read the status in the database once the main process is completed.</p>
            
            <p>In general it is always better to use start conditions in case any kind of status is involved as with the calculation during runtime for schedule conditions EWM sometimes does not load all items of the delivery into the memory (e.g. it calculates based on one item only which might not necessarily lead to the correct result on header level). For further details about the status calculation I recommend reading SAP note 1461585.</p>
            
            <p>A quick look into the other application areas before we close this 2<sup>nd</sup> step. We learned now that for warehouse requests the object-related data for the relevant search fields is collected via method <code>/SCWM/CL_DLV_PPF_CONF</code> -<code>CREATE_REQUESTS</code>. For the other application areas the approach is quite similar –</p>
            <ul>
                <li>Handling Unit related PPF actions
                    <ul>
                        <li>The interface method of the condition evaluation BAdi calls function module <code>/SCWM/SCHEDULE_COND_HU</code></li>
                        <li>This FM determines the search fields and fills the application data into the condition record search fields</li>
                    </ul>
                </li>
                <li>Physical Inventory related PPF actions
                    <ul>
                        <li>The interface method of the condition evaluation BAdi directly determines the search fields and fills the application data into the condition record search fields</li>
                    </ul>
                </li>
                <li>Warehouse order related PPF actions
                    <ul>
                        <li>The interface method of the condition evaluation BAdi calls function module <code>/SCWM/SCHEDULE_COND_WO</code></li>
                        <li>This FM determines the search fields and fills the application data into the condition record search fields</li>
                    </ul>
                </li>
            </ul>
            
            <p><u>Fill fields which are not filled via standard logic</u></p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_21.png" alt="SAP EWM PPF condition records_21" loading="lazy">
            </div>
            
            <p>Within this important step we can add data via BAdi <code>/SCWM/EX_DLV_PPF_CONF</code>. This is for sure required in case we added Z-fields to the field catalogue and to the condition tables. Note that this could also be some standard fields as not all fields from the standard field catalogue are being filled by the standard methods mentioned under step 2.</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_22.png" alt="SAP EWM PPF condition records_22" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_23.png" alt="SAP EWM PPF condition records_23" loading="lazy">
            </div>
            
            <p>Check note 2739237 and class <code>/SCWM/CL_EI_DLV_PPF_CONF_EXAMP</code>-<code>/SCWM/IF_EX_DLV_PPF_CONF~ADD_CATALOG_FIELDS</code> to get some insights into an example implementation for this BAdi (the example shows how to fill the field value for the DPX status on the delivery header).</p>
            
            <p>Again, a quick look at the other areas before we close this step:</p>
            <ul>
                <li>In the context of HU-related PPF actions additional fields can be filled via BAdi <code>/SCWM/EX_PRNT_CCAT_HU</code></li>
                <li>In the context of PI-related PPF actions additional fields can be filled via BAdi <code>/SCWM/EX_PRNT_CCAT_PI</code></li>
                <li>In the context of WO-related PPF actions additional fields can be filled via BAdi <code>/SCWM/EX_PRNT_CCAT_WO</code></li>
            </ul>
            
            <p><u>Read condition records based on the data collected in the previous steps</u></p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_24.png" alt="SAP EWM PPF condition records_24" loading="lazy">
            </div>
            
            <p>Here we finally read the condition records. EWM uses all data collected within the previous steps to collect all records where the content matches the characteristics of the given object:</p>
            <ul>
                <li>Tables with the field names</li>
                <li>Request- / object-related data</li>
                <li>Determination procedure</li>
            </ul>
            
            <p>Based on the records that where found, EWM sets the return variables:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_25.png" alt="SAP EWM PPF condition records_25" loading="lazy">
            </div>
            
            <p>Function module <code>IPC_CT_CNF_DETERMINE_MULTI</code> is the most important player in this context. It is being used to read condition records in the context of all different applications mentioned in this blog post (~ for warehouse requests and in the same way for HU, WO or PI related actions).</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_26.png" alt="SAP EWM PPF condition records_26" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_27.png" alt="SAP EWM PPF condition records_27" loading="lazy">
            </div>
            
            <p>I do not want to dig deep into the content of this function module. A detailed code-review does not add any value here from my perspective. In summary - it compares the imported data listed above with the values in the condition records of the relevant condition tables. The result is returned via table <code>lt_result</code> (see screenshot above). It is then further processed/evaluated in order to set the value of the return variable of the evaluation method and subsequently the parameter <code>EP_RC</code> in the interface method of the BAdi for the schedule or start condition.</p>
            
            <p>Remember the screenshots that I showed you at the beginning of this post already:</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_28.png" alt="SAP EWM PPF condition records_28" loading="lazy">
            </div>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_29.png" alt="SAP EWM PPF condition records_29" loading="lazy">
            </div>
            
            <p>This should subsequently close the loop which</p>
            <ul>
                <li>started with the trigger of an evaluation for PPF action scheduling/starting</li>
                <li>executed a comparison between application object related data and the condition records</li>
            </ul>
            
            <p>finally saved the decision about this in the exporting variable of the BAdi for scheduling or start conditions</p>
            
            <div class="screenshot-container">
                <img src="../../assets/images/reveal/rev-condition-record/SAP EWM PPF condition records_30.png" alt="SAP EWM PPF condition records_30" loading="lazy">
            </div>
            
            <p>I hope you could learn something and I could shed some light on how EWM evaluates condition records in the context of the Post Processing Framework.</p>
            
        </div>

        <!-- STAY UPDATED SECTION -->
        <div class="stay-updated">
            <!-- Newsletter Card -->
            <div class="stay-updated-card">
                <div>
                    <h3>📧 Newsletter</h3>
                    <p>Get updates about new blog posts directly in your inbox.</p>
                </div>
                <form action="https://online.us17.list-manage.com/subscribe/post?u=3dbafeb5441a290b4bfdeeb38&id=226759b4e6&f_id=00e24be0f0" method="post" class="newsletter-form" target="_blank" rel="noopener noreferrer">
                    <input type="email" name="EMAIL" placeholder="Your email" required>
                    <input type="text" name="FNAME" placeholder="First name">
                    <input type="text" name="LNAME" placeholder="Last name">
                    <input type="text" name="b_3dbafeb5441a290b4bfdeeb38_226759b4e6" style="display: none;" tabindex="-1">
                    <button type="submit" class="btn-subscribe">Subscribe</button>
                </form>
            </div>

            <!-- YouTube Card -->
            <div class="stay-updated-card">
                <div>
                    <h3>▶️ YouTube Channel</h3>
                    <p>Subscribe to my channel for regular tutorials & insights about SAP EWM.</p>
                </div>
                <a href="https://www.youtube.com/@sapewm?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="btn-youtube" >Subscribe on YouTube</a>
            </div>
        </div>

        <!-- FREELANCER CTA (Commented out - to be launched later)
        <section class="freelancer-cta" aria-labelledby="cta-heading">
            <h2 id="cta-heading">Need Support around SAP EWM?</h2>
            <p>WMexperts.online is the knowledge hub of Hendrik, a Senior SAP EWM Consultant with expertise in functional design, technical implementation, and project leadership.</p>
            <a href="#" class="btn-primary">Explore My Offerings →</a>
        </section>
        -->
    </article>

    <!-- ENHANCED LIGHTBOX OVERLAY -->
    <div id="lightbox">
        <span class="lightbox-close" id="lightbox-close">&times;</span>
        <span class="lightbox-prev" id="lightbox-prev">&#8249;</span>
        <span class="lightbox-next" id="lightbox-next">&#8250;</span>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="">
        </div>
        <div class="lightbox-counter" id="lightbox-counter"></div>
    </div>

    <footer id="main-footer"></footer>

    <!-- ENHANCED LIGHTBOX JAVASCRIPT -->
    <script>
        (function() {
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxPrev = document.getElementById('lightbox-prev');
            const lightboxNext = document.getElementById('lightbox-next');
            const lightboxCounter = document.getElementById('lightbox-counter');
            
            // Get all images that should be zoomable
            const images = document.querySelectorAll('.screenshot-container img, .content img');
            let currentImageIndex = 0;

            // Add click event to all images
            images.forEach((img, index) => {
                img.addEventListener('click', function() {
                    openLightbox(index);
                });
            });

            function openLightbox(index) {
                currentImageIndex = index;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                lightbox.classList.add('active');
                document.body.classList.add('lightbox-open');
                updateCounter();
                
                // Show/hide navigation arrows based on number of images
                if (images.length <= 1) {
                    lightboxPrev.style.display = 'none';
                    lightboxNext.style.display = 'none';
                } else {
                    lightboxPrev.style.display = 'block';
                    lightboxNext.style.display = 'block';
                }
            }

            function closeLightbox() {
                lightbox.classList.remove('active');
                document.body.classList.remove('lightbox-open');
            }

            function showPrevImage() {
                currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                updateCounter();
            }

            function showNextImage() {
                currentImageIndex = (currentImageIndex + 1) % images.length;
                lightboxImg.src = images[currentImageIndex].src;
                lightboxImg.alt = images[currentImageIndex].alt;
                updateCounter();
            }

            function updateCounter() {
                if (images.length > 1) {
                    lightboxCounter.textContent = `${currentImageIndex + 1} / ${images.length}`;
                    lightboxCounter.style.display = 'block';
                } else {
                    lightboxCounter.style.display = 'none';
                }
            }

            // Event listeners
            lightboxClose.addEventListener('click', function(e) {
                e.stopPropagation();
                closeLightbox();
            });

            lightboxPrev.addEventListener('click', function(e) {
                e.stopPropagation();
                showPrevImage();
            });

            lightboxNext.addEventListener('click', function(e) {
                e.stopPropagation();
                showNextImage();
            });

            // Click on overlay background to close
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (!lightbox.classList.contains('active')) return;
                
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft') {
                    showPrevImage();
                } else if (e.key === 'ArrowRight') {
                    showNextImage();
                }
            });

            // Prevent image content click from closing lightbox
            lightboxImg.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        })();
    </script>

    <script>
    // Load global components
    fetch('/header-content.html').then(res => res.text()).then(html => document.getElementById('main-header').innerHTML = html);
    fetch('/footer-content.html').then(res => res.text()).then(html => document.getElementById('main-footer').innerHTML = html);
    </script>

</body>
</html>




